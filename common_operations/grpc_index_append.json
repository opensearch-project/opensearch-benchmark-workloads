{% if distribution_version_unknown is defined %}
  {% set distribution_version = "3.3.0" %}
{% endif %}

{%- set version_parts = distribution_version.split('.') | map('int') | list %}
{%- set min_version = "3.3.0".split('.') | map('int') | list %}
{%- set max_version = "6.0.0".split('.') | map('int') | list %}

{%- if version_parts >= min_version and version_parts < max_version %}
    {
        "name": "grpc-index-append",
        "operation": "grpc-index-append",
        "warmup-time-period": {{ warmup_time_period | default(120) | tojson }},
        "clients": {{bulk_indexing_clients | default(8)}},
        "ignore-response-error-level": "{{error_level | default('non-fatal')}}"
    },
    {
        "name": "refresh-after-index",
        "operation": "refresh"
    }
{% else %}
    {% include 'error: gRPC ' ~ distribution_version ~ ' is not supported in versions < 3.3.0' %}
{% endif %}