{
    "operation": "delete-index"
},
{
    "operation": {
        "operation-type": "create-index",
        "settings": {{index_settings | default(default_index_settings | default({})) | tojson}}
    }
},
{
    "name": "check-cluster-health",
    "operation": {
        "operation-type": "cluster-health",
        "index": "{{ index_name }}",
        "request-params": {
            "wait_for_status": "{{cluster_health | default('green')}}",
            "wait_for_no_relocating_shards": "true"
        },
        "retry-until-success": true
    }
},
{
    "operation": "grpc-index-append",
    "warmup-time-period": {{ warmup_time_period | default(120) | tojson }},
    "clients": {{bulk_indexing_clients | default(8)}},
    "ignore-response-error-level": "{{error_level | default('non-fatal')}}"
},
{
    "name": "refresh-after-index",
    "operation": "refresh"
},
{
    "operation": {
        "operation-type": "force-merge",
        "request-timeout": {{ request_timeout | default(60) | tojson }}{%- if max_num_segments is defined %},
        "max-num-segments": {{ max_num_segments | tojson }}
        {%- endif %}
    }
},
{
    "name": "refresh-after-force-merge",
    "operation": "refresh"
},
{
    "name": "wait-until-merges-finish",
    "operation": {
        "operation-type": "index-stats",
        "index": "_all",
        "condition": {
            "path": "_all.total.merges.current",
            "expected-value": 0
        },
        "retry-until-success": true,
        "include-in-reporting": false
    }
},
{
  "name": "grpc-match-all",
  "operation": "grpc-match-all",
  "warmup-iterations": {{ warmup_iterations | default(200) | tojson }},
  "iterations": {{ test_iterations | default(100) | tojson }},
  "target-throughput": {{ target_throughput | default(2) | tojson }},
  "clients": {{ search_clients | default(1) }}
},
{
  "name": "grpc-term",
  "operation": "grpc-term",
  "warmup-iterations": {{ warmup_iterations | default(200) | tojson }},
  "iterations": {{ test_iterations | default(100) | tojson }},
  "target-throughput": {{ target_throughput | default(2) | tojson }},
  "clients": {{ search_clients | default(1) }}
}